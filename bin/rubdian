#!/usr/bin/env ruby

require "rubdian"
require "rubdian/version"
require "logger"
require "rubdian/trollop"

Rubdian.logger.level = Logger::DEBUG
logger = Rubdian.logger

logger.debug("Starting rubdian #{Rubdian::VERSION}")


# parse arguments

SUB_COMMANDS = ["setup", "collect", "update"]
SUBS = {
          'setup' => Rubdian::Command::Setup,
          'collect' => Rubdian::Command::Collect,
          'update' => Rubdian::Command::Update
}

gopts = Trollop::options do
  version = "rubdian #{Rubdian::VERSION} (c) 2013 CORPEX Internet GmbH"
  opt :concurrent, "Run n threads in concurrent", :short => "-c", :default => 1
  stop_on SUB_COMMANDS
end

cmd = ARGV.shift

logger.debug("Running #{cmd} (#{SUBS[cmd]})")
